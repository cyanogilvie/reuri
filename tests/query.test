if {[lsearch [namespace children] ::tcltest] == -1} {
    package require tcltest
    namespace import ::tcltest::*
}

tcltest::loadTestedCommands
package require reuri

set t	query_values
test $t-1.0.0 {empty}			{ reuri::query values {} foo					} {}
test $t-1.0.1 {empty}			{ reuri::query values {?} foo					} {}
test $t-1.1 {missing}			{ reuri::query values {?xyz=a} foo				} {}
test $t-1.2 {exists, single}	{ reuri::query values {?foo=a} foo				} a
test $t-1.3 {exists, multiple}	{ reuri::query values {?foo=a&foo=bar} foo		} {a bar}
test $t-1.4 {exists, multiple}	{ reuri::query values {?foo=a&x=y&foo=bar} foo	} {a bar}

set t	uri_query_values
test $t-1.0.0 {empty}			{ reuri::uri query values {} foo					} {}
test $t-1.0.1 {empty}			{ reuri::uri query values {?} foo					} {}
test $t-1.0.2 {empty}			{ reuri::uri query values {http:} foo				} {}
test $t-1.0.3 {empty}			{ reuri::uri query values {http:?} foo				} {}
test $t-1.1 {missing}			{ reuri::uri query values {http://localhost/a?xyz=a} foo				} {}
test $t-1.2 {exists, single}	{ reuri::uri query values {http://localhost/a?foo=a} foo				} a
test $t-1.3 {exists, multiple}	{ reuri::uri query values {http://localhost/a?foo=a&foo=bar} foo		} {a bar}
test $t-1.4 {exists, multiple}	{ reuri::uri query values {http://localhost/a?foo=a&x=y&foo=bar} foo	} {a bar}

set t	query_exists
test $t-1.0.0 {empty}			{ reuri::query exists {} foo					} 0
test $t-1.0.1 {empty}			{ reuri::query exists {?} foo					} 0
test $t-1.1 {missing}			{ reuri::query exists {?xyz=a} foo				} 0
test $t-1.2 {exists, single}	{ reuri::query exists {?foo=a} foo				} 1
test $t-1.3 {exists, multiple}	{ reuri::query exists {?foo=a&foo=bar} foo		} 1
test $t-1.4 {exists, multiple}	{ reuri::query exists {?foo=a&x=y&foo=bar} foo	} 1
test $t-1.5 {exists, multiple}	{ reuri::query exists {foo=a&x=y&foo=bar} foo	} 1
test $t-1.6 {exists, multiple}	{ reuri::query exists {foo=a&x=y&foo=bar} bar	} 0

set t	uri_query_exists
test $t-1.0.0 {empty}			{ reuri::uri query exists {} foo					} 0
test $t-1.0.1 {empty}			{ reuri::uri query exists {?} foo					} 0
test $t-1.1 {missing}			{ reuri::uri query exists {?xyz=a} foo				} 0
test $t-1.2 {exists, single}	{ reuri::uri query exists {?foo=a} foo				} 1
test $t-1.3 {exists, multiple}	{ reuri::uri query exists {?foo=a&foo=bar} foo		} 1
test $t-1.4 {exists, multiple}	{ reuri::uri query exists {?foo=a&x=y&foo=bar} foo	} 1
test $t-1.5 {exists, multiple}	{ reuri::uri query exists {http://localhost/x?foo=a&x=y&foo=bar} foo	} 1
test $t-1.6 {exists, multiple}	{ reuri::uri query exists {http://localhost/x?foo=a&x=y&foo=bar} bar	} 0

set t	query_names
test $t-1.0.0 {empty}			{ reuri::query names {}						} {}
test $t-1.0.1 {empty}			{ reuri::query names {?}					} {}
test $t-1.1 {missing}			{ reuri::query names {?xyz=a}				} xyz
test $t-1.2 {exists, single}	{ reuri::query names {?foo=a}				} foo
test $t-1.3 {exists, multiple}	{ reuri::query names {?foo=a&foo=bar}		} {foo foo}
test $t-1.4 {exists, multiple}	{ reuri::query names {?foo=a&x=y&foo=bar}	} {foo x foo}

set t	uri_query_names
test $t-1.0.0 {empty}			{ reuri::uri query names {}						} {}
test $t-1.0.1 {empty}			{ reuri::uri query names {?}					} {}
test $t-1.0.1 {empty}			{ reuri::uri query names {http:}				} {}
test $t-1.0.3 {empty}			{ reuri::uri query names {http://localhost/z}	} {}
test $t-1.0.4 {empty}			{ reuri::uri query names {http://localhost/z?}	} {}
test $t-1.1 {missing}			{ reuri::uri query names {http://localhost/z?xyz=a}				} xyz
test $t-1.2 {exists, single}	{ reuri::uri query names {http://localhost/z?foo=a}				} foo
test $t-1.3 {exists, multiple}	{ reuri::uri query names {http://localhost/z?foo=a&foo=bar}		} {foo foo}
test $t-1.4 {exists, multiple}	{ reuri::uri query names {http://localhost/z?foo=a&x=y&foo=bar}	} {foo x foo}

set t	query_get
test $t-1.0.0.0 {empty}	-body   { reuri::query get {} foo						} -returnCodes error -errorCode {REURI PARAM_NOT_SET foo} -result {param "foo" doesn't exist}
test $t-1.0.0.1 {empty} -body	{ reuri::query get {} foo -default				} -returnCodes error -errorCode {TCL ARGUMENT MISSING} -result {missing argument to "-default"}
test $t-1.0.0.1 {empty}			{ reuri::query get {} foo -default def			} def
test $t-1.0.1.0 {empty}	-body   { reuri::query get {?} foo						} -returnCodes error -errorCode {REURI PARAM_NOT_SET foo} -result {param "foo" doesn't exist}
test $t-1.0.1.1 {empty}			{ reuri::query get {?} foo -default def			} def
test $t-1.1.0 {missing} -body	{ reuri::query get {?xyz=a} foo					} -returnCodes error -errorCode {REURI PARAM_NOT_SET foo} -result {param "foo" doesn't exist}
test $t-1.1.1 {missing}			{ reuri::query get {?xyz=a} foo -default def	} def
test $t-1.2.0 {exists, single}	{ reuri::query get {?foo=a} foo					} a
test $t-1.2.1 {exists, single}	{ reuri::query get {?foo=a} foo	-default def	} a
test $t-1.3 {exists, multiple}	{ reuri::query get {?foo=a&foo=bar} foo			} bar
test $t-1.4 {exists, multiple}	{ reuri::query get {?foo=a&x=y&foo=bar} foo		} bar
test $t-2.0.0 {empty}			{ reuri::query get {}							} {}
test $t-2.0.1 {empty}			{ reuri::query get {?}							} {}
test $t-2.1 {missing}			{ reuri::query get {?xyz=a}						} {xyz a}
test $t-2.2 {exists, single}	{ reuri::query get {?foo=a}						} {foo a}
test $t-2.3 {exists, multiple}	{ reuri::query get {?foo=a&foo=bar}				} {foo a foo bar}
test $t-2.4 {exists, multiple}	{ reuri::query get {?foo=a&x=y&foo=bar}			} {foo a x y foo bar}
test $t-2.5 {exists, multiple}	{ reuri::query get {foo=a&x=y&foo=bar}			} {foo a x y foo bar}
if 0 {
test $t-3.0 {exists, multiple}	{ reuri::query get {?foo=a&x=y&foo=bar&foo=z} foo -index 0	} a
test $t-3.1 {exists, multiple}	{ reuri::query get {?foo=a&x=y&foo=bar&foo=z} foo -index 1	} bar
test $t-3.2 {exists, multiple}	{ reuri::query get {?foo=a&x=y&foo=bar&foo=z} foo -index 2	} z
test $t-3.3 {exists, multiple}	{ reuri::query get {?foo=a&x=y&foo=bar&foo=z} foo -index end	} z
test $t-3.4 {exists, multiple}	{ reuri::query get {?foo=a&x=y&foo=bar&foo=z} foo -index end-1	} bar
test $t-3.5.1 {exists, multiple} -body	{ reuri::query get {?foo=a&x=y&foo=bar&foo=z} foo -index 3				} -returnCodes error -errorCode {REURI PARAM_NOT_SET foo} -result {param "foo"[3] doesn't exist}
test $t-3.5.2 {exists, multiple} -body	{ reuri::query get {?foo=a&x=y&foo=bar&foo=z} foo -index 3 -default def	} -result def
test $t-3.5.3 {exists, multiple} -body	{ reuri::query get {?foo=a&x=y&foo=bar&foo=z} foo -index end+1			} -returnCodes error -errorCode {REURI PARAM_NOT_SET foo} -result {param "foo"[end+1] doesn't exist}
test $t-3.5.4 {exists, multiple} -body	{ reuri::query get {?foo=a&x=y&foo=bar&foo=z} foo -index end+1 -default def		} -result def
test $t-3.5.5 {exists, multiple}		{ reuri::query get {?foo=a&x=y&foo=bar&foo=z} foo -index 3 -default def			} def
test $t-3.6 {exists, multiple}			{ reuri::query get {?foo=a&x=y&foo=bar&foo=z} foox -index 0..end -default def	} {}
test $t-3.7 {exists, multiple} -body	{ reuri::query get {?foo=a&x=y&foo=bar&foo=z} foox -index 0..0					} {}
test $t-3.8.1 {exists, multiple} -body	{ reuri::query get {?foo=a&x=y&foo=bar&foo=z} foox -index 0..0,1				} -returnCodes error -errorCode {REURI PARAM_NOT_SET foox} -result {param "foox"[1] doesn't exist}
test $t-3.8.2 {exists, multiple} -body	{ reuri::query get {?foo=a&x=y&foo=bar&foo=z} foox -index 0..0,1 -default def	} -result def
test $t-3.8.3 {exists, multiple} -body	{ reuri::query get {?foo=a&x=y&foo=bar&foo=z} foox -index 2,0..0,1 -default def	} -result {def def}
}

set t	uri_query_get
test $t-1.0.0 {empty}		{ reuri::uri query get {}									} {}
test $t-1.0.1 {empty}		{ reuri::uri query get http:								} {}
test $t-1.0.2 {empty}		{ reuri::uri query get http://localhost						} {}
test $t-1.0.3 {empty}		{ reuri::uri query get http://localhost/foo					} {}
test $t-1.0.4 {empty}		{ reuri::uri query get http://localhost/foo#frag			} {}
test $t-1.0.5 {empty}		{ reuri::uri query get /foo/bar								} {}
test $t-1.0.6 {empty}		{ reuri::uri query get foo/bar								} {}
test $t-1.0.7 {empty}		{ reuri::uri query get #frag								} {}
test $t-1.1.0 {simple}		{ reuri::uri query get http://localhost/foo?foo=bar&x=y		} {foo bar x y}
test $t-1.1.1 {simple}		{ reuri::uri query get /foo?foo=bar&x=y						} {foo bar x y}
test $t-1.1.2 {simple}		{ reuri::uri query get foo?foo=bar&x=y						} {foo bar x y}
test $t-1.1.3 {multiple}	{ reuri::uri query get foo?foo=bar&x=y&foo=baz				} {foo bar x y foo baz}
test $t-1.1.4 {multiple}	{ reuri::uri query get foo?foo=bar&x=y&foo=baz#frag			} {foo bar x y foo baz}
test $t-1.1.5 {multiple}	{ reuri::uri query get ?foo=bar&x=y&foo=baz					} {foo bar x y foo baz}
test $t-1.1.6 {multiple}	{ reuri::uri query get ?foo=bar&x=y&foo=baz#frag			} {foo bar x y foo baz}
test $t-2.0.0 {empty}		-body { reuri::uri query get {} foo									} -returnCodes error -errorCode {REURI PARAM_NOT_SET foo} -result {param "foo" doesn't exist}
test $t-2.0.1 {empty}		-body { reuri::uri query get http: foo								} -returnCodes error -errorCode {REURI PARAM_NOT_SET foo} -result {param "foo" doesn't exist}
test $t-2.0.2 {empty}		-body { reuri::uri query get http://localhost foo					} -returnCodes error -errorCode {REURI PARAM_NOT_SET foo} -result {param "foo" doesn't exist}
test $t-2.0.3 {empty}		-body { reuri::uri query get http://localhost/foo foo				} -returnCodes error -errorCode {REURI PARAM_NOT_SET foo} -result {param "foo" doesn't exist}
test $t-2.0.4 {empty}		-body { reuri::uri query get http://localhost/foo#frag foo			} -returnCodes error -errorCode {REURI PARAM_NOT_SET foo} -result {param "foo" doesn't exist}
test $t-2.0.5 {empty}		-body { reuri::uri query get /foo/bar foo							} -returnCodes error -errorCode {REURI PARAM_NOT_SET foo} -result {param "foo" doesn't exist}
test $t-2.0.6 {empty}		-body { reuri::uri query get foo/bar foo							} -returnCodes error -errorCode {REURI PARAM_NOT_SET foo} -result {param "foo" doesn't exist}
test $t-2.0.7 {empty}		-body { reuri::uri query get #frag foo								} -returnCodes error -errorCode {REURI PARAM_NOT_SET foo} -result {param "foo" doesn't exist}
test $t-2.1.0 {simple}		-body { reuri::uri query get http://localhost/foo?foo=bar&x=y foo	} -result bar
test $t-2.1.1 {simple}		-body { reuri::uri query get /foo?foo=bar&x=y foo					} -result bar
test $t-2.1.2 {simple}		-body { reuri::uri query get foo?foo=bar&x=y foo					} -result bar
test $t-2.1.3 {multiple}	-body { reuri::uri query get foo?foo=bar&x=y&foo=baz foo			} -result baz
test $t-2.1.4 {multiple}	-body { reuri::uri query get foo?foo=bar&x=y&foo=baz#frag foo		} -result baz
test $t-2.1.5 {multiple}	-body { reuri::uri query get ?foo=bar&x=y&foo=baz foo				} -result baz
test $t-2.1.6 {multiple}	-body { reuri::uri query get ?foo=bar&x=y&foo=baz#frag foo			} -result baz
test $t-3.0.0 {empty}		-body { reuri::uri query get {} foo -default def								} -result def
test $t-3.0.1 {empty}		-body { reuri::uri query get http: foo -default def								} -result def
test $t-3.0.2 {empty}		-body { reuri::uri query get http://localhost foo -default def					} -result def
test $t-3.0.3 {empty}		-body { reuri::uri query get http://localhost/foo foo -default def				} -result def
test $t-3.0.4 {empty}		-body { reuri::uri query get http://localhost/foo#frag foo -default def			} -result def
test $t-3.0.5 {empty}		-body { reuri::uri query get /foo/bar foo -default def							} -result def
test $t-3.0.6 {empty}		-body { reuri::uri query get foo/bar foo -default def							} -result def
test $t-3.0.7 {empty}		-body { reuri::uri query get #frag foo -default def								} -result def
test $t-3.1.0 {simple}		-body { reuri::uri query get http://localhost/foo?foo=bar&x=y foo -default def	} -result bar
test $t-3.1.1 {simple}		-body { reuri::uri query get /foo?foo=bar&x=y foo -default def					} -result bar
test $t-3.1.2 {simple}		-body { reuri::uri query get foo?foo=bar&x=y foo -default def					} -result bar
test $t-3.1.3 {multiple}	-body { reuri::uri query get foo?foo=bar&x=y&foo=baz foo -default def			} -result baz
test $t-3.1.4 {multiple}	-body { reuri::uri query get foo?foo=bar&x=y&foo=baz#frag foo -default def		} -result baz
test $t-3.1.5 {multiple}	-body { reuri::uri query get ?foo=bar&x=y&foo=baz foo -default def				} -result baz
test $t-3.1.6 {multiple}	-body { reuri::uri query get ?foo=bar&x=y&foo=baz#frag foo -default def			} -result baz

# cleanup
::tcltest::cleanupTests
return

# vim: ft=tcl foldmethod=marker foldmarker=<<<,>>> ts=4 shiftwidth=4
